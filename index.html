<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدیریت هوشمند قبض آب</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <h1>مدیریت هوشمند قبض آب</h1>

    <button id="settingsBtn">تنظیمات</button>
    <button id="historyBtn">تاریخچه</button>

    <div>
        <label>نام دوره:</label>
        <input type="text" id="periodName">
    </div>
    <div>
        <label>تاریخ قبض:</label>
        <input type="date" id="billDate">
    </div>
    <div>
        <label>مبلغ کل قبض (تومان):</label>
        <input type="number" id="totalBill" min="0">
    </div>

    <table id="unitsTable">
        <thead>
            <tr>
                <th>شماره واحد</th>
                <th>نام واحد</th>
                <th>قرائت قبلی</th>
                <th>قرائت فعلی</th>
                <th>میزان مصرف (متر مکعب)</th>
                <th>پله مصرف</th>
                <th>مبلغ (تومان)</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="6">جمع کل</td>
                <td id="totalAmount">0</td>
            </tr>
            <tr>
                <td colspan="6">مابه التفاوت (مبلغ قبض - جمع مبالغ)</td>
                <td id="difference">0</td>
            </tr>
        </tfoot>
    </table>

    <div>
        <button id="addUnit">افزودن واحد جدید</button>
        <button id="savePeriod">ذخیره دوره فعلی</button>
        <button id="newPeriod">شروع دوره جدید</button>
        <button id="exportPDF">خروجی PDF</button>
        <button id="exportExcel">خروجی Excel</button>
        <button id="importExcel">ورود از Excel</button>
    </div>

    <!-- Modal تنظیمات -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>تنظیمات محاسبه هزینه</h2>
            <label><input type="radio" name="calcMode" value="manual" checked> پلکانی دستی</label>
            <label><input type="radio" name="calcMode" value="auto"> تنظیم خودکار</label>

            <div id="manualTiersSection">
                <p>در این حالت، تعرفه هر پلکان مصرف را به صورت دستی وارد می‌کنید.</p>
                <div id="manualTiers"></div>
                <button id="addManualTier">+ افزودن پلکان</button>
            </div>

            <div id="autoTiersSection" style="display: none;">
                <p>در این حالت، برنامه با دریافت ضرایب مصرف، رقم مبنا را طوری محاسبه می‌کند که جمع مبالغ واحدها برابر با مبلغ کل قبض شود.</p>
                <div id="autoTiers"></div>
                <button id="addAutoTier">+ افزودن پلکان</button>
            </div>

            <button id="saveSettings">ذخیره تنظیمات</button>
        </div>
    </div>

    <!-- Modal تاریخچه -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>تاریخچه دوره‌ها</h2>
            <ul id="historyList"></ul>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>